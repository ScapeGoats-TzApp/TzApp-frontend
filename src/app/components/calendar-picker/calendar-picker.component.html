<div class="calendar-container">
  <!-- Search and Calendar Bar -->
  <div class="bg-cyan-light/20 rounded-[20px] border-b border-cyan p-3 relative">
    <div class="flex items-center gap-2">
      <input 
        type="text" 
        [value]="inputValue()"
        (input)="onInputChange($event)"
        (focus)="onInputFocus()"
        (blur)="onInputBlur()"
        (keydown)="onKeyDown($event)"
        [placeholder]="googleMapsReady() ? 'Search for a city' : 'Loading...'"
        [disabled]="disabled || !googleMapsReady()"
        class="flex-1 bg-white/20 rounded-[20px] border-b border-cyan px-4 py-2 text-navy-90 font-bold text-sm placeholder:text-gray-300 placeholder:lowercase focus:outline-none focus:ring-2 focus:ring-cyan"
        style="letter-spacing: -1.05px;"
      />
      @if (loading()) {
        <div class="w-9 h-9 rounded-[20px] border-r border-cyan bg-white/20 flex items-center justify-center">
          <div class="spinner"></div>
        </div>
      } @else {
        <button class="w-9 h-9 rounded-[20px] border-r border-cyan bg-white/20 flex items-center justify-center">
          <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="11" cy="11" r="6" stroke="#26658C"/>
            <path d="M11 8C10.606 8 10.2159 8.0776 9.85195 8.22836C9.48797 8.37913 9.15726 8.6001 8.87868 8.87868C8.6001 9.15726 8.37913 9.48797 8.22836 9.85195C8.0776 10.2159 8 10.606 8 11" stroke="#26658C" stroke-linecap="round"/>
            <path d="M20 20L17 17" stroke="#26658C" stroke-linecap="round"/>
          </svg>
        </button>
      }
      <button 
        (click)="toggleCalendar()" 
        [disabled]="disabled"
        class="w-12 h-12 flex items-center justify-center"
      >
        <svg class="w-12 h-12" viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect x="6" y="13" width="38" height="8" rx="2" fill="rgba(126, 134, 158, 0.25)"/>
          <rect x="6" y="13" width="38" height="31" rx="2" stroke="rgba(38, 101, 140, 0.34)" stroke-width="1.2"/>
          <path d="M15 6L15 13" stroke="rgba(38, 101, 140, 0.34)" stroke-width="1.2" stroke-linecap="round"/>
          <path d="M35 6L35 13" stroke="rgba(38, 101, 140, 0.34)" stroke-width="1.2" stroke-linecap="round"/>
          <rect x="15" y="25" width="8" height="4" rx="0.5" fill="rgba(38, 101, 140, 0.34)"/>
          <rect x="15" y="33" width="8" height="4" rx="0.5" fill="rgba(38, 101, 140, 0.34)"/>
          <rect x="27" y="25" width="8" height="4" rx="0.5" fill="rgba(38, 101, 140, 0.34)"/>
          <rect x="27" y="33" width="8" height="4" rx="0.5" fill="rgba(38, 101, 140, 0.34)"/>
        </svg>
      </button>
    </div>
  </div>

  <!-- Search Suggestions Dropdown -->
  @if (showSuggestions() && predictions().length > 0) {
    <div class="suggestions-dropdown">
      @for (prediction of predictions(); track prediction.place_id; let i = $index) {
        <div
          class="suggestion-item"
          [class.selected]="i === selectedIndex()"
          (click)="selectPrediction(prediction)"
          (mousedown)="$event.preventDefault()"
        >
          <div class="location-icon">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M8 0C4.69 0 2 2.69 2 6c0 4.5 6 10 6 10s6-5.5 6-10c0-3.31-2.69-6-6-6zm0 8c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z" fill="currentColor"/>
            </svg>
          </div>
          <div class="suggestion-content">
            <div class="suggestion-main">
              {{ getPredictionDisplayText(prediction) }}
            </div>
            @if (getPredictionSecondaryText(prediction)) {
              <div class="suggestion-secondary">
                {{ getPredictionSecondaryText(prediction) }}
              </div>
            }
          </div>
        </div>
      }
    </div>
  }

  <!-- Calendar Dropdown -->
  @if (isOpen()) {
    <div class="calendar-dropdown">
      <!-- Calendar Header -->
      <div class="calendar-header">
        <button (click)="previousMonth()" class="nav-button">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M10 12L6 8L10 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
        <h3 class="month-year">{{ getMonthName() }}</h3>
        <button (click)="nextMonth()" class="nav-button">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M6 4L10 8L6 12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>

      <!-- Day Names Header -->
      <div class="day-names">
        @for (dayName of getDayNames(); track dayName) {
          <div class="day-name">{{ dayName }}</div>
        }
      </div>

      <!-- Calendar Grid -->
      <div class="calendar-grid">
        @for (date of getDaysInMonth(); track date.getTime()) {
          <button
            (click)="selectDate(date)"
            [class.today]="isToday(date)"
            [class.selected]="isSelected(date)"
            [class.other-month]="!isCurrentMonth(date)"
            class="calendar-day"
          >
            {{ date.getDate() }}
          </button>
        }
      </div>
    </div>
  }

  <!-- Backdrop to close calendar when clicking outside -->
  @if (isOpen()) {
    <div class="calendar-backdrop" (click)="closeCalendar()"></div>
  }
</div>
